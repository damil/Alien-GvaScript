<html>
<head>

    <link href="../../lib/Alien/GvaScript/lib/GvaScript.css" rel="stylesheet" type="text/css">
    <script src="../../lib/Alien/GvaScript/lib/prototype.js"></script>
    <script src="../../lib/Alien/GvaScript/lib/GvaScript.js"></script>

<script>

var menus = {"magistrats":{"6":[{"LABEL":["BEF","BELLANGER Fran\u00e7ois"],"MAG_NAME":"BELLANGER Fran\u00e7ois","USER_ID":"BEF"},{"LABEL":["BOY","BONARD YVES"],"MAG_NAME":"BONARD YVES","USER_ID":"BOY"},{"LABEL":["HOM","HOTTELIER Michel"],"MAG_NAME":"HOTTELIER Michel","USER_ID":"HOM"},{"LABEL":["GRK","GRODECKI St\u00e9phane"],"MAG_NAME":"GRODECKI St\u00e9phane","USER_ID":"GRK"},{"LABEL":["TOD","TORELLO Mario-Dominique"],"MAG_NAME":"TORELLO Mario-Dominique","USER_ID":"TOD"}],"S1":[{"LABEL":["THE","TH\u00c9LIN Philippe"],"MAG_NAME":"TH\u00c9LIN Philippe","USER_ID":"THE"},{"LABEL":["BOV","BOVY Laure"],"MAG_NAME":"BOVY Laure","USER_ID":"BOV"},{"LABEL":["BON","HURNI Eliane"],"MAG_NAME":"HURNI Eliane","USER_ID":"BON"}],"1":[{"LABEL":["DUM","DUMARTHERAY Daniel"],"MAG_NAME":"DUMARTHERAY Daniel","USER_ID":"DUM"}],"4":[{"LABEL":["THE","TH\u00c9LIN Philippe"],"MAG_NAME":"TH\u00c9LIN Philippe","USER_ID":"THE"}],"S2":[{"LABEL":["BOV","BOVY Laure"],"MAG_NAME":"BOVY Laure","USER_ID":"BOV"},{"LABEL":["GAC","JUNOD Christine"],"MAG_NAME":"JUNOD Christine","USER_ID":"GAC"},{"LABEL":["DUM","DUMARTHERAY Daniel"],"MAG_NAME":"DUMARTHERAY Daniel","USER_ID":"DUM"}],"3":[{"LABEL":["BON","HURNI Eliane"],"MAG_NAME":"HURNI Eliane","USER_ID":"BON"}],"2":[{"LABEL":["BOV","BOVY Laure"],"MAG_NAME":"BOVY Laure","USER_ID":"BOV"}],"5":[{"LABEL":["GAC","JUNOD Christine"],"MAG_NAME":"JUNOD Christine","USER_ID":"GAC"}]},"langue_maitrise":[{"LIB_MAITRISE_LANGUE":"A - Maternelle","C_MAITRISE_LANGUE":"A"},{"LIB_MAITRISE_LANGUE":"B - Active","C_MAITRISE_LANGUE":"B"},{"LIB_MAITRISE_LANGUE":"C - Passive","C_MAITRISE_LANGUE":"C"}],"types_roles":{"TEM":[],"REC":[],"INT":[]},"roles_parties":[{"C_ROLE_PARTIE":"REC","LABEL_ROLE":["REC","Recourant"],"C_ROLE_PARTIE_TXT":"Recourant"},{"C_ROLE_PARTIE":"INT","LABEL_ROLE":["INT","Intim\u00e9"],"C_ROLE_PARTIE_TXT":"Intim\u00e9"},{"C_ROLE_PARTIE":"TEM","LABEL_ROLE":["TEM","Temoin"],"C_ROLE_PARTIE_TXT":"Temoin"}],"specialisation_interp":[{"LIB_SPECIALIS_INTERP":"CIV - Civile","C_SPECIALIS_INTERP":"CIV"},{"LIB_SPECIALIS_INTERP":"FIN - Finance","C_SPECIALIS_INTERP":"FIN"},{"LIB_SPECIALIS_INTERP":"PEN - P\u00e9nale","C_SPECIALIS_INTERP":"PEN"}],"chambres":["S1","S2","1","2","3","4","5","6"],"motifs":[{"LABEL_MOTIF":["ACTPEC","Actions p\u00e9cuniaires"],"TXT_MOTIF":"Actions p\u00e9cuniaires","C_MOTIF":"ACTPEC"},{"LABEL_MOTIF":["AIG","A\u00e9roport international de GE"],"TXT_MOTIF":"A\u00e9roport international de GE","C_MOTIF":"AIG"},{"LABEL_MOTIF":["CM","Communes"],"TXT_MOTIF":"Communes","C_MOTIF":"CM"},{"LABEL_MOTIF":["DEC","D\u00e9cision attaqu\u00e9e :"],"TXT_MOTIF":"D\u00e9cision attaqu\u00e9e :","C_MOTIF":"DEC"},{"LABEL_MOTIF":["EPM","Etablissements publics m\u00e9dicaux"],"TXT_MOTIF":"Etablissements publics m\u00e9dicaux","C_MOTIF":"EPM"},{"LABEL_MOTIF":["HG","Hospice g\u00e9n\u00e9ral"],"TXT_MOTIF":"Hospice g\u00e9n\u00e9ral","C_MOTIF":"HG"},{"LABEL_MOTIF":["IP","Instruction publique (ex CRIPP)"],"TXT_MOTIF":"Instruction publique (ex CRIPP)","C_MOTIF":"IP"},{"LABEL_MOTIF":["OPE","Office du personnel"],"TXT_MOTIF":"Office du personnel","C_MOTIF":"OPE"},{"LABEL_MOTIF":["POL","Police"],"TXT_MOTIF":"Police","C_MOTIF":"POL"},{"LABEL_MOTIF":["PRI","Prison"],"TXT_MOTIF":"Prison","C_MOTIF":"PRI"},{"LABEL_MOTIF":["RECEP","R\u00e9ception du recours :"],"TXT_MOTIF":"R\u00e9ception du recours :","C_MOTIF":"RECEP"},{"LABEL_MOTIF":["SI","Services industriels"],"TXT_MOTIF":"Services industriels","C_MOTIF":"SI"},{"LABEL_MOTIF":["TPG","Transports publics genevois"],"TXT_MOTIF":"Transports publics genevois","C_MOTIF":"TPG"}]};


var motifs_ac= 
  new GvaScript.AutoCompleter(menus.motifs || [], {
     minimumChars: 0,
     autoSuggest: false,
     strict: true,
     blankOK: true,
     maxHeight: 150,
     caseSensitive: false,
     typeAhead: false,
     classes: {'loading': 'loading'},
     labelField: 'LABEL_MOTIF',
     valueField: 'C_MOTIF'
    });


function set_autocompleter_values(event, prefix, elem, destination, callback) {
  var autocompleter = event.controller;
  if (!destination)
    destination = elem;
    
  if (destination && destination.length != elem.length) 
    alert("Pas le même nombre dans entre sources et destinations (" + elem.length + " vs. " + destination.length + ")");
  
  if (elem && elem.length > 0) {
    for (var i=0; i<elem.length; i++) {
      // on peut avoir une liste de champs
      var e = elem[i];
      var dest = destination[i];
      var cleId = prefix ? prefix + '.' + dest : dest;
      if (e.match(/__/)) {
        var ar = /(.*)__/.exec(e);
        e = ar[1];
      }
      if (autocompleter.choices[event.index][e])
        $(cleId).value = autocompleter.choices[event.index][e];
      else
        $(cleId).value = '';
    }
  }
  if ( callback ) {
    callback();
  }
}

function setSelectionRange(input, selectionStart, selectionEnd) {
  input = $(input);
  if (input.setSelectionRange) {
    input.focus();
    input.setSelectionRange(selectionStart, selectionEnd);
  }
  else if (input.createTextRange) {
    var range = input.createTextRange();
    range.collapse(true);
    range.moveEnd('character', selectionEnd);
    range.moveStart('character', selectionStart);
    range.select();
  }
}

function moveCursorToEnd(input) {
    pos   = $F(input).length;
    setSelectionRange(input, pos, pos);
}

</script>

</head>


<body>

<form>
    <input name="field_prefix.C_MOTIF" size="15" id="field_prefix.C_MOTIF" 
           autocomplete="off" 
           class="inputComplete" 
           title="Code motif" 
           dm:onValueChange="elem.lastValue=elem.value"
           onfocus="motifs_ac.autocomplete(this);"
           onLeave="moveCursorToEnd('field_prefix.TXT_MOTIF');"
           onComplete="if ((this.lastValue != this.value) || (!$('field_prefix.TXT_MOTIF').value)) {
                        this.lastValue = this.value;
                        set_autocompleter_values(event, 'field_prefix', ['TXT_MOTIF']);} "></input>

    <input name="field_prefix.TXT_MOTIF" id="field_prefix.TXT_MOTIF" 
           autocomplete="off" size="60" 
           onblur="if($('field_prefix.TXT_MOTIF').value && !$('field_prefix.C_MOTIF').value) $('field_prefix.C_MOTIF').value='LIBRE';"
           title="Descriptif du motif"></input>

<br>

<button type="button">
  Fake submit
</button>



</form>


</body>

</html>
